MEPH.define("MEPH.mobile.mixins.Activity",{ParentAlreadySetMessage:"Activity.js : Child already has a parent",isActivity:function(){return true},getActivityId:function(){var a=this;a.$activityId=a.$activityId||MEPH.GUID();return a.$activityId},setPath:function(b){var a=this;a.$activityPath=b},getPath:function(){var a=this;return a.$activityPath},getActivityPath:function(){var a=this;return a.$activityPath},afterShow:function(){},afterHide:function(){},addChildDomActivity:function(b){var a=this;a.activities=a.activities||[];b.setDomParent(a);a.activities.push(b)},setDomParent:function(a){var b=this;if(b.domParent){throw new Error(b.ParentAlreadySetMessage)}b.domParent=a},setActivityArguments:function(b){var a=this;a.activityArguments=b;if(a.fire){a.fire("activity arguments set",{value:b})}},getPath:function(){var b=this,a;a=b.getActivityArguments();if(a){return a.path||""}return""},getActivityArguments:function(){var a=this;return a.activityArguments||null},getDomParent:function(){var a=this;return a.domParent||null},getDomAnscestors:function(){var a=[],c=this,b=c.getDomParent();do{if(b){a.push(b);b=b.getDomParent()}}while(b);return a},getActivities:function(){var a=this;a.activities=a.activities||[];return a.activities},isDomChild:function(d){var b=this,a,c=b.getActivities();a=c.first(function(e){return e===d||b.isDomChild(d)});return !!a},initOpen:function(d){var f=this,c,e,b=Promise.resolve(),a;e=MEPH.Array(f.getDomAnscestors().reverse());if(!d||!d.skipAnscestors){e.foreach(function(g){b=b.then(function(){return g.initOpen({skipAnscestors:true})})})}return Promise.resolve().then(b).then(function(){if(f.show){return f.open().then(function(){return{success:true}})["catch"](function(){return{success:false,error:new Error("There was a problem opening: Activity.js")}})}return Promise.resolve().then(function(){return{success:true}})})},initShow:function(c){var e=this,b,d,f=Promise.resolve(),a;d=e.getDomAnscestors();if(!c||!c.skipAnscestors){d.foreach(function(g){f=f.then(function(){return g.initShow({skipAnscestors:true})})})}return Promise.resolve().then(f).then(function(){if(e.show){return e.show().then(function(){return{success:true}})["catch"](function(){return{success:false,error:new Error("There was a problem opening: Activity.js")}})}return Promise.resolve().then(function(){return{success:true}})})},getEarliestCommonAnscestor:function(d){var c,b=this,e=MEPH.Array([b].concat(b.getDomAnscestors())),a=MEPH.Array([d].concat(d.getDomAnscestors()));c=a.where(function(f){return e.contains(function(g){return g===f})});return c.first()},getAnscestorsBetween:function(e){var d=this,c=[],b=e.getEarliestCommonAnscestor(d);if(b){var a=d.getDomAnscestors().indexOf(b);if(a!==-1){c=d.getDomAnscestors().subset(0,a)}}return c},initHide:function(d){var e=this,c,f,a=Promise.resolve(),b;if(d&&d.activityToBeShown&&!d.skipAnscestors){f=e.getAnscestorsBetween(d.activityToBeShown);if(f.length===0){f=e.getDomAnscestors()}f.foreach(function(g){a=a.then(function(){return g.initHide({skipAnscestors:true})})})}return Promise.resolve().then(a).then(function(){if(e.hide){if(d&&d.activityToBeShown&&d.activityToBeShown.getDomAnscestors().contains(function(g){return g===e})){return Promise.resolve().then(function(){return{success:true}})}else{return e.hide().then(function(){return{success:true}})["catch"](function(){return{success:false,error:new Error("There was a problem opening: Activity.js")}})}}return Promise.resolve().then(function(){return{success:true}})})},activityLoaded:function(){var b=this,a;a=b.getDomTemplate().first(function(c){return c.nodeType===MEPH.util.Dom.elementType});a.dispatchEvent(MEPH.createEvent("activityload",{activity:b}));b.getDomTemplate().foreach(function(c){b.don("activityload",c,function(d){if(d.parentset){d.preventDefault();return false}b.addChildDomActivity(d.activity);d.parentset=true;d.preventDefault();return false},b);b.don(MEPH.mobile.activity.view.ActivityView.CloseActivity,c,function(d){MEPH.publish(MEPH.Constants.closeView,{activity:b})},b)})},initClose:function(){var a=this,c=Promise.resolve(),b=a.getActivities();b.foreach(function(d){c=c.then(function(){return d.initClose()})});return Promise.resolve().then(c).then(function(){if(a.close){return a.close().then(function(d){return{success:d}})}return Promise.resolve().then(function(){return{success:true}})["catch"](function(){return{success:false,error:new Error("There was a problem opening: Activity.js")}})})}});