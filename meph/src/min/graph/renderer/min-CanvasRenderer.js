MEPH.define("MEPH.graph.renderer.CanvasRenderer",{requires:["MEPH.util.Renderer"],properties:{},statics:{defaultKey:"default",$canvasCache:null,defaultOptions:{canvas:{attributes:{height:300,width:400}}},cacheDomBag:document.body},initialize:function(){var a=this;MEPH.graph.renderer.CanvasRenderer.$canvasCache=MEPH.graph.renderer.CanvasRenderer.$canvasCache||MEPH.util.Observable.observable([]);a.$canvasCache=MEPH.graph.renderer.CanvasRenderer.$canvasCache;a.renderer=new MEPH.util.Renderer()},setCanvas:function(a){var b=this;b.$canvas=a;b.renderer.setCanvas(a)},drawToCache:function(b,a){b=b||MEPH.graph.renderer.CanvasRenderer.defaultKey;var c=this,d=c.clearCache(b);if(!d){d=c.createCache(b)}d.draw(a)},drawCached:function(b,c){c=c||MEPH.graph.renderer.CanvasRenderer.defaultKey;b=b||{};var d=this;var a=d.getCached(c);b.shape=pgx.Renderer.shapes.canvas;b.canvas=a.renderer.getCanvas();if(a.renderer){d.renderer.draw(b)}},getCached:function(a){var b=this;a=a||MEPH.graph.renderer.CanvasRenderer.defaultKey;return b.$canvasCache.first(function(c){return c.key===a})},createCache:function(b,e,a){var d=this;var c={key:b,options:a||d.getDefaultOptions(),renderer:e||d.getRenderer()};d.$canvasCache.push(c);return c.renderer},getDefaultOptions:function(){return MEPH.graph.renderer.CanvasRenderer.defaultOptions},getRenderer:function(){var b=this;var c=new MEPH.util.Renderer();var a=b.getCanvas();c.setCanvas(a);return c},getCanvas:function(){MEPH.graph.renderer.CanvasRenderer.cacheDomBag=MEPH.graph.renderer.CanvasRenderer.cacheDomBag||document.body;var b=this,a=document.createElement("canvas");MEPH.graph.renderer.CanvasRenderer.cacheDomBag.appendChild(a);b.applyCanvasOptions(a);return a},applyCanvasOptions:function(b,a){a=a||MEPH.graph.renderer.CanvasRenderer.defaultOptions.canvas.attributes;for(var c in a){b.setAttribute(c,a[c])}},clearCache:function(b){var c=this;var a=false;c.$canvasCache.where(function(d){a=d.renderer;return d.key===b}).foreach(function(d){d.renderer.clear()});return a},purgeCache:function(){MEPH.graph.renderer.CanvasRenderer.$canvasCache.removeWhere(function(a){a.renderer.destroy(true);return true})},destroy:function(a){var b=this;if(a){b.purgeCache()}b.renderer.destroy(a)},destroyCache:function(a){MEPH.graph.renderer.CanvasRenderer.$canvasCache.removeWhere(function(b){if(b.key===a){b.renderer.destroy(true);return true}return false})},renderNode:function(b,a){throw"not implemented"},setOptions:function(a){var b=this;b.$options=a},getOptions:function(){var a=this;return a.$options},render:function(){var a=this;a.draw(a.getOptions())},draw:function(a){throw"must implement this function"}});