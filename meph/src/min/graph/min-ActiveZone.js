MEPH.define("MEPH.graph.ActiveZone",{properties:{raiseZIndex:12,textPopupTemplate:'<div activezone="holder"><input type="text" activezone="texttemplate" /></div>'},initialize:function(){var a=this;MEPH.Events(a)},statics:{canCreateConnection:function(c,b){var a=true;if(c.$options&&c.$options.option&&c.$options.option.canConnect){a=a&&c.$options.option.canConnect(c,b)}if(b.$options&&b.$options.option&&b.$options.option.canConnect){a=a&&b.$options.option.canConnect(b,c)}return a},type:{connector:"connector",color:"color",select:"select",header:"header",custom:"custom",title:"title"}},onTitleZoneClick:function(c,a){var d=this,b;switch(d.$options.option.type){case"custom":b=d.$options.option.generator(d,a);break;default:b=d.createTextPopup(a,["title","variable"]);break}if(b){b.az.addEventListener("activezoneblur",function(){b.az.parentNode.removeChild(b.az);d.getNode().fire("move",{})})}},onColorZoneClick:function(c,a){var d=this,b;switch(d.$options.option.type){case"custom":b=d.$options.option.generator(d,a);break;default:b=d.createTextPopup(a,"value");break}if(b){b.az.addEventListener("activezoneblur",function(){b.az.parentNode.removeChild(b.az);d.getNode().fire("move",{})})}},isEnumerable:function(){var a=this;if(a.getOptions()&&a.getOptions().option){return a.getOptions().option.enumerable}return false},isMatching:function(){var a=this;if(a.getOptions()&&a.getOptions().option){return a.getOptions().option.matchingoutput}return false},createTextPopup:function(d,g){var f=this;var b=document.createElement("div");var a=document.body.appendChild(b);a.innerHTML=f.textPopupTemplate;if(!Array.isArray(g)){g=[g]}var e=a.querySelector('[activezone="holder"]');e.style.position="fixed";e.style.zIndex=10000;e.style.top=d.evt.clientY+"px";e.style.left=d.evt.clientX+"px";var c=a.querySelector('[activezone="texttemplate"]');c.addEventListener("change",function(){f.fire("change",{})});c.addEventListener("blur",function(){g.foreach(function(h){f.$options.option[h]=c.value});f.getDom().setAttribute("title",c.value);c.dispatchEvent(MEPH.createEvent("activezoneblur",{bubbles:true}))});c.value=f.$options.option[g.first()];document.body.appendChild(a.firstChild);c.focus();return{az:e,azt:c}},setGraphViewPort:function(b){var a=this;a.$graphviewport=b;a.$graphviewport.on("moved",a.onViewPortChange.bind(a));a.$graphviewport.on("change",a.onViewPortChange.bind(a))},getGraphViewPort:function(b){var a=this;return a.$graphviewport},isDraggable:function(){var a=this;return a.$draggable},setZoneType:function(a){var b=this;b.$zoneType=a},getZoneType:function(){var a=this;return a.$zoneType},isConnector:function(){var a=this;return a.getZoneType()===pgx.ActiveZone.type.connector},setOptions:function(a){var b=this;b.$options=a;b.setDomTitle()},getOptions:function(){var a=this;return a.$options},onViewPortChange:function(){var a=this,b=a.getGraphViewPort().getPosition();a.setRelativePosition(b.x,b.y,b.z)},onClick:function(b){var a=this;if(a.$clickable){a.fire("click",{dom:a.getDom(),evt:b})}},onMouseDown:function(b){var a=this;if(a.$draggable){a.fire("activezone_dragstart",{dom:a.getDom(),evt:b})}},setDom:function(b){var a=this;a.$dom=b;var c=a.getGraphViewPort();if(c&&(!a.getOptions()||!a.getOptions().managed)){c.getDock().appendChild(b)}if(a.$clickable){Style.cursor(b,"pointer")}a.interactivity();if((!a.getOptions()||!a.getOptions().managed)){Style.position(b,"absolute");Style.zIndex(b,a.raiseZIndex)}a.$dom.addEventListener("mousedown",a.onMouseDown.bind(a));a.$dom.addEventListener("click",a.onClick.bind(a));a.setDomTitle();a.ignoreMouse()},ignoreMouse:function(b){var a=this;if(a.getDom()&&(b||a.$ignoreMouse)){a.getDom().style.pointerEvents="none"}else{if(b!==undefined){a.$ignoreMouse=b}}},setDomTitle:function(){var a=this;if(a.getDom()&&a.$options&&a.$options.option&&a.$options.option){switch(a.getZoneType()){case ActiveZone.type.color:a.$dom.setAttribute("title",a.$options.option.value);break;case ActiveZone.type.title:a.$dom.setAttribute("title",a.$options.option.title);break}}},setNode:function(b){var a=this;a.$node=b;if(b&&b.addZone){b.addZone(a)}},getNode:function(){var a=this;return a.$node},getId:function(){var a=this;return a.id},getDom:function(){var a=this;return a.$dom},destroy:function(){var a=this;if(a.getDom()&&a.getDom().parentNode&&(!a.getOptions()||!a.getOptions().managed)){a.getDom().parentNode.removeChild(a.getDom())}a.fire("destroy",a)},isOutput:function(){var a=this;if((a.getOptions()&&a.getOptions().managed)){return a.getOptions().option.isOutput}return a.getNode().isOutput(a.getOptions().option)},clickable:function(a){var b=this;b.$clickable=a!==undefined?a:true;var c=b.getDom();if(c){Style.cursor(c,"pointer")}b.setDomTitle()},draggable:function(a){var b=this;b.$draggable=a!==undefined?a:true;b.interactivity()},interactivity:function(){var a=this;if(!a.$draggable&&a.getDom()){}},setRelativePosition:function(a,e,d){var b=this,c=b.getDom();b.$relativeposition=new J3DIVector3(a,e,d)},setPosition:function(a,h,g,d){var e=this,c=0,b=0,f=e.getDom();e.$position=new J3DIVector3(a,h,g);if(e.$relativeposition){}if(e.$$$timeout){clearTimeout(e.$$$timeout)}if(f&&(!e.stoppedMoveAbility||d)&&(!e.getOptions()||!e.getOptions().managed)){Style.translate(f,(a+c),(h+b))}},getPosition:function(){var a=this;if(a.$position){return{x:a.$position[0],y:a.$position[1],z:a.$position[2]}}return null}});