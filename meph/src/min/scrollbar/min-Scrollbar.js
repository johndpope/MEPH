MEPH.define("MEPH.scrollbar.Scrollbar",{alias:"scrollbar",templates:true,requires:["MEPH.util.Style","MEPH.util.Dom"],extend:"MEPH.control.Control",properties:{dragging:"dragging",horizontal:true,barheight:20,handleheight:16,handleoffset:1,virtualsize:0,scrollbarposition:0,minhandlesize:30},initialize:function(){var a=this;a.callParent.apply(a,arguments);a.cache={};a.on("altered",function(c,b){if(b.property==="virtualsize"||b.path==="virtualsize"||b.path==="minhandlesize"||b.path==="horizontal"){a.horizontal=a.horizontal==="false"||!a.horizontal?false:true;a.sizehandle();a.stylebar()}});window.addEventListener("resize",a.sizehandle.bind(a))},onLoaded:function(){var a=this;a.callParent.apply(a,arguments);a.appendEvents();a.stylebar()},sizehandle:function(){var a=this;if(a.horizontal){Style.width(a.handle,Math.max(a.minhandlesize,a.bar.clientWidth*(a.bar.clientWidth/a.virtualsize)))}else{Style.height(a.handle,Math.max(a.minhandlesize,a.bar.clientHeight/a.virtualsize))}},stylebar:function(){var a=this;if(a.horizontal){Style.clear(a.bar,"width");Style.height(a.bar,a.barheight);Style.top(a.handle,a.handleoffset);Style.height(a.handle,a.handleheight)}else{Style.clear(a.bar,"height");Style.width(a.bar,a.barheight);Style.left(a.handle,a.handleoffset);Style.width(a.handle,a.handleheight)}},appendEvents:function(){var b=this;b.handle.addEventListener("mousedown",function(f){var c=MEPH.util.Dom.getScreenEventPositions(f).first();var d=MEPH.util.Dom.getEventPositions(f).first();b.state=b.dragging;b.start_position=b.horizontal?c.x:c.y;b.handlePos=b.getBarPosition();b.handleoffset=d});b.bar.addEventListener("click",function(g){if(g.srcElement!==b.bar){return}var d=MEPH.util.Dom.getEventPositions(g).first();b.position=b.horizontal?d.x:d.y;var f=b.getBarPosition();var c=b.barSize();b.setBarPosition(b.position);b.scrollbarposition=b.getBarPosition()/(b.barSize()-b.handleSize())});document.body.addEventListener("mousemove",function(d){if(b.state===b.dragging){var c=MEPH.util.Dom.getScreenEventPositions(d).first();b.position=b.horizontal?c.x:c.y;b.setBarPosition(b.position-b.start_position);b._scrollbarposition=b.getBarPosition()/(b.barSize()-b.handleSize())}});var a=function(c){b.state=null;b.start_position=null;b.scrollbarposition=b._scrollbarposition};document.body.addEventListener("mouseup",a)},handleSize:function(){var a=this;return parseFloat(a.horizontal?a.handle.clientWidth:a.handle.clientHeight)||0},barSize:function(){var a=this;return parseFloat(a.horizontal?a.bar.clientWidth:a.bar.clientHeight)||0},getBarPosition:function(){var a=this;if(a.horizontal){return parseFloat(a.handle.offsetLeft)||0}return parseFloat(a.handle.offsetTop)||0},setBarPosition:function(c){var b=this;if(b.horizontal){var a=b.bar.clientWidth-b.handle.clientWidth;Style.left(b.handle,Math.max(0,Math.min(a,b.handlePos+c)))}else{var a=b.bar.clientHeight-b.handle.clientHeight;Style.top(b.handle,Math.max(0,Math.min(a,b.handlePos+c)))}}});