MEPH.define("MEPH.util.Renderer",{requires:["MEPH.util.Vector"],properties:{},setCanvas:function(a){var b=this;b.$context=null;b.$canvas=a},getCanvas:function(){var a=this;return a.$canvas},getContext:function(){var a=this;a.$context=a.$context||a.getCanvas().getContext("2d");return a.$context},draw:function(a){var c=this,b=c.getContext();if(!Array.isArray(a)){a=[a]}a.foreach(function(e,d){b.save();e=c.applyDefaults(e);switch(e.shape){case MEPH.util.Renderer.shapes.rectangle:c.drawRectangle(e);break;case MEPH.util.Renderer.shapes.circle:c.drawCircle(e);break;case MEPH.util.Renderer.shapes.text:c.drawText(e);break;case MEPH.util.Renderer.shapes.line:c.drawLine(e);break;case MEPH.util.Renderer.shapes.canvas:c.drawCanvas(e);break;case MEPH.util.Renderer.shapes.polygon:c.drawPolygon(e);break;case MEPH.util.Renderer.shapes.none:break;default:throw"undefined shape type"}b.restore()});return true},clear:function(){try{var c=this,a=c.getCanvas(),b=c.getContext();b.clearRect(0,0,a.width,a.height)}catch(d){return false}return true},setFillStyle:function(a,b){b.fillStyle=a.fillStyle||"rbg(0,0,0)";if(a.gradientFillStyle){var c=a.gradientFillStyle;var d=b.createLinearGradient(c.x0,c.y0,c.x1,c.y1);c.colorStops.foreach(function(e,f){d.addColorStop(e.stop,e.color)});b.fillStyle=d}},drawRectangle:function(a){var c=this,b=c.getContext();c.setFillStyle(a,b);b.lineWidth=a.lineWidth!==undefined?a.lineWidth:1;b.strokeStyle=a.strokeStyle!==undefined?a.strokeStyle:"rbg(0,0,0)";b.roundRect(a.x,a.y,a.width,a.height,a.radius||0,a.fill||false,a.stroke||false)},drawPolygon:function(a){var c=this,b=c.getContext();b.strokeStyle=a.strokeStyle;c.setFillStyle(a,b);b.beginPath();b.moveTo(a.lt.x,a.lt.y);b.lineTo(a.rt.x,a.rt.y);b.lineTo(a.rb.x,a.rb.y);b.lineTo(a.lb.x,a.lb.y);b.closePath();b.fill()},drawLine:function(b){var e=this,d=e.getContext();var c=new MEPH.util.Vector(b.end.x,b.end.y);var a=new MEPH.util.Vector(b.start.x,b.start.y);d.beginPath();d.strokeStyle=b.strokeStyle;e.setFillStyle(b,d);d.moveTo(b.start.x,b.start.y);d.lineWidth=b.lineWidth;d.lineTo(b.end.x,b.end.y);d.stroke()},drawBezier:function(b){var h=this,d=h.getContext();var c=new MEPH.util.Vector(b.end.x,b.end.y);var a=new MEPH.util.Vector(b.start.x,b.start.y);var i=MEPH.util.Vector.Lerp2D(a,c,0.25).rotate(0.13);var e=MEPH.util.Vector.Lerp2D(a,c,0.75).rotate(-0.13);d.beginPath();d.strokeStyle=b.strokeStyle;h.setFillStyle(b,d);d.moveTo(b.start.x,b.start.y);d.lineWidth=b.lineWidth;d.bezierCurveTo(i._x,i._y,e._x,e._y,b.end.x,b.end.y);d.stroke()},drawCircle:function(a){var c=this,b=c.getContext();b.strokeStyle=a.strokeStyle;c.setFillStyle(a,b);b.beginPath();b.arc(a.x,a.y,a.radius,0,Math.PI*2,true);b.closePath();b.stroke();b.fill()},drawCanvas:function(a){var c=this,b=c.getContext();if(a.center){b.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,-a.canvas.width/2,-a.canvas.height/2,a.canvas.width,a.canvas.height)}else{if(a.positioned){b.drawImage(a.canvas,a.x,a.y)}else{if(a.simple){b.putImageData(a.canvas,0,0)}else{b.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,0,0,a.canvas.width,a.canvas.height)}}}},drawText:function(a){var c=this,b=c.getContext();b.font=a.font;c.setFillStyle(a,b);b.textAlign=a.textAlign;b.textBaseline=a.textBaseline;b.fillText(a.text,a.x,a.y,a.maxWidth)},applyDefaults:function(a){a=a||{};for(var b in MEPH.util.Renderer.defaultShapeOptions){if(a[b]===undefined){a[b]=MEPH.util.Renderer.defaultShapeOptions[b]}}return a},destroy:function(b){var c=this;if(b){var a=c.getCanvas();if(a){a.parentNode.removeChild(a)}}},statics:{shapes:{rectangle:"rectangle",circle:"circle",text:"text",line:"line",canvas:"canvas",polygon:"polygon",none:"none"},defaultShapeOptions:{x:50,y:50,width:100,height:100,radius:100,textBaseline:"middle",maxWidth:1000,fillStyle:"#ff0000",strokeStyle:"#0000ff",fill:"#ff0000",font:"22px Verdana",stroke:true}}});CanvasRenderingContext2D.prototype.roundRect=function(f,e,a,g,c,h,i){var b={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};if(typeof i=="undefined"){i=true}if(typeof c==="object"){for(var d in c){b[d]=c[d]}}else{if(typeof(c)==="number"){for(var d in b){b[d]=c}}}this.beginPath();this.moveTo(f+b.upperLeft,e);this.lineTo(f+a-b.upperRight,e);this.quadraticCurveTo(f+a,e,f+a,e+b.upperRight);this.lineTo(f+a,e+g-b.lowerRight);this.quadraticCurveTo(f+a,e+g,f+a-b.lowerRight,e+g);this.lineTo(f+b.lowerLeft,e+g);this.quadraticCurveTo(f,e+g,f,e+g-b.lowerLeft);this.lineTo(f,e+b.upperLeft);this.quadraticCurveTo(f,e,f+b.upperLeft,e);this.closePath();if(i){this.stroke()}if(h){this.fill()}};