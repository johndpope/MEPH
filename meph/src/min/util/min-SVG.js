MEPH.define("MEPH.util.SVG",{requires:["MEPH.util.Vector"],statics:{shapes:{rectangle:"rectangle",circle:"circle",text:"text",line:"line",canvas:"canvas",bezier:"bezier"},defaultShapeOptions:{x:50,y:50,"stroke-dasharray":"",width:100,height:100,radius:100,textBaseline:"middle",maxWidth:1000,fillStyle:"#000000",strokeStyle:"#000000",fill:"#000000",strokeWidth:"2px",font:"22px Verdana",stroke:true}},properties:{batchdraw:false,parts:null},initialize:function(){var a=this;a.parts=[];a.unused=[]},setCanvas:function(a){var b=this;b.$svg=a},getCanvas:function(){var a=this;return a.$svg},getContext:function(){var a=this;a.$svg=a.$svg||a.getCanvas();return a.$svg},draw:function(b){var e=this,d=[],a=[],c=e.getContext();if(!Array.isArray(b)){b=[b]}if(e.batchdraw){d=e.parts.select()}b.foreach(function(g,f){g=e.applyDefaults(g);switch(g.shape){case MEPH.util.Renderer.shapes.rectangle:var h=d.removeFirstWhere(function(i){i.options.shape===g.shape}).first();a=a.concat(e.drawRectangle(g,h?h.shape:null));break;case MEPH.util.SVG.shapes.bezier:case MEPH.util.SVG.shapes.line:a=a.concat(e.drawLine(g));break;case MEPH.util.SVG.shapes.text:a=a.concat(e.drawText(g));break;case MEPH.util.SVG.shapes.circle:a=a.concat(e.drawCircle(g));break}});if(e.batchdraw){d.foreach(function(f){e.remove(f)})}a.foreach(function(f){e.parts.push(f)});return a},remove:function(c){var a=this;var b=a.parts.removeWhere(function(d){return d===c});b.foreach(function(d){if(d.shape.parentNode){d.shape.parentNode.removeChild(d.shape)}})},clear:function(){var b=this,a=b.getCanvas();a.childNodes.select().foreach(function(c){if(c.parentNode){c.parentNode.removeChild(c)}})},drawRectangle:function(d,e){var g=this,c,b,h,a;c=g.getCanvas();var f="http://www.w3.org/2000/svg";if(!e){h=true}else{b=e.shape;d=g.applyDefaults(d)}b=b||document.createElementNS(f,"rect");b.setAttributeNS(null,"x",d.x);b.setAttributeNS(null,"y",d.y);b.setAttributeNS(null,"width",d.width);b.setAttributeNS(null,"height",d.height);b.setAttributeNS(null,"stroke",d.strokeStyle);b.setAttributeNS(null,"stroke-width",d.strokeWidth);b.setAttributeNS(null,"fill",d.fillStyle);if(h){c.appendChild(b)}return{shape:b,options:d}},drawText:function(c){var a;var e="http://www.w3.org/2000/svg";a=document.createElementNS(e,"text");a.innerHTML=c.text;if(c.hasOwnProperty("x")){a.setAttribute("x",c.x)}if(c.hasOwnProperty("y")){a.setAttribute("y",c.y)}if(c.hasOwnProperty("dx")){a.setAttribute("dx",c.dx)}if(c.hasOwnProperty("dy")){a.setAttribute("dy",c.dy)}if(c.hasOwnProperty("fill")){a.setAttribute("fill",c.fill)}var d=this;var b=d.getCanvas();b.appendChild(a);return{shape:a,options:c}},drawLine:function(i,a){var g=this,f,b,e,h,j;b=g.getCanvas();var c="http://www.w3.org/2000/svg";if(!a){h=true}else{e=a.shape;i=g.applyDefaults(i)}e=e||document.createElementNS(c,"path");if(i.shape===MEPH.util.SVG.shapes.line){f="M"+i.start.x+" "+i.start.y+" L"+i.end.x+" "+i.end.y}else{if(i.shape===MEPH.util.SVG.shapes.bezier){f="M"+i.start.x+", "+i.start.y+" C "+i.bezier1.x+" "+i.bezier1.y+", "+i.bezier2.x+" "+i.bezier2.y+", "+i.end.x+" "+i.end.y}}e.setAttributeNS(null,"d",f);if(i["stroke-dasharray"]){e.setAttributeNS(null,"stroke-dasharray",i["stroke-dasharray"])}if(i.fill!=="css"){e.setAttributeNS(null,"fill",i.fill)}if(i.strokeStyle!=="css"){e.setAttributeNS(null,"style","stroke:"+i.strokeStyle+"; stroke-width:"+i.strokeWidth+";")}if(i["class"]){e.classList.add(i["class"])}if(h){b.appendChild(e)}return{shape:e,options:i}},drawCircle:function(d,e){var g=this,c,b,h,a;c=g.getCanvas();var f="http://www.w3.org/2000/svg";if(!e){h=true}else{b=e.shape;d=g.applyDefaults(d)}b=b||document.createElementNS(f,"circle");b.setAttributeNS(null,"cx",d.x);b.setAttributeNS(null,"cy",d.y);b.setAttributeNS(null,"r",d.radius);b.setAttributeNS(null,"stroke",d.stroke);b.setAttributeNS(null,"stroke-width",d.strokeWidth);b.setAttributeNS(null,"fill",d.fill);if(h){c.appendChild(b)}return{shape:b,options:d}},applyDefaults:function(a){a=a||{};for(var b in MEPH.util.SVG.defaultShapeOptions){if(a[b]===undefined){a[b]=MEPH.util.SVG.defaultShapeOptions[b]}}return a}});