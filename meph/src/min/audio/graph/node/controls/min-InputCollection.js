MEPH.define("MEPH.audio.graph.node.controls.InputCollection",{alias:"inputcollection",templates:true,scripts:["MEPH.audio.graph.node.controls.InputCollectionForm"],requires:["MEPH.util.Dom","MEPH.util.SVG"],extend:"MEPH.audio.graph.node.controls.AudioControl",properties:{collection:null},initialize:function(){var a=this;a.great();a.on("altered",function(c,b){if(b.path==="collection"){a.collection.un(a);a.collection.on("changed",a.updateControlList.bind(a),a)}});a.renderer=new MEPH.util.SVG()},enterValue:function(){var a=this;a.createForm()},onLoaded:function(){var a=this;a.great();a.getFirstElement().dispatchEvent(MEPH.createEvent("height",{height:a.controlheight}))},updateControlList:function(){var c=this;c.renderer.setCanvas(c.collectiongroup);c.renderer.clear();var b=15;var a=-b;c.svgs=c.collection.select(function(d){a+=b;return{text:d.name+" : "+d.type,shape:MEPH.util.SVG.shapes.text,dy:a,fill:"#ffffff",x:3}});c.renderer.draw(c.svgs);c.controlheight=a+24;c.getFirstElement().dispatchEvent(MEPH.createEvent("height",{height:c.controlheight}))},addField:function(b){var a=this;if(a.collection&&a.collection.all(function(c){return c.name!==b.name})){a.collection.push(b);return true}return false},createForm:function(){var e=this;var c=MEPH.getTemplate("MEPH.audio.graph.node.controls.InputCollectionForm");var d=MEPH.util.Dom.createInputElementOverSvg(e.getFirstElement(),"div");d.innerHTML=c.template;var h=d.querySelector("select");h.setAttribute("placeholder","Input/Output(s)");var j=function(){MEPH.util.Dom.clearSelect(h);e.collection.foreach(function(k){MEPH.util.Dom.addOption(k.name,k.connector,h)})};j();Style.width(d,300);var g=d.querySelector("input");g.setAttribute("placeholder","name");var b;var f,i;var a=[{setFunc:function(k){if(k&&e.collection.all(function(l){return l.name!==k})){if(i){i.name=k;i.title=k;j();e.updateControlList();h.selectedIndex=e.collection.indexOf(i)}}},element:g},{setFunc:function(k){i=e.collection.first(function(l){return l.connector===k})||i},element:h}];MEPH.util.Dom.addSimpleDataEntryToElments(e,a,d)}});