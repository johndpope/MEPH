MEPH.define("MEPH.audio.processor.RateTransposer",{extend:"MEPH.audio.processor.FIFOProcessor",requires:["MEPH.audio.effects.AAFilter","MEPH.audio.processor.FIFOSampleBuffer"],statics:{},properties:{numChannels:1,bUseAAFilter:true,fSlopeCount:0,tempBuffer:null,fRate:0,sPrevSampleR:0,sPrevSampleL:0,storeBuffer:null,pAAFilter:null},initialize:function(a){var b=this;b.storeBuffer=new MEPH.audio.processor.FIFOSampleBuffer(1);b.tempBuffer=new MEPH.audio.processor.FIFOSampleBuffer(1);b.pAAFilter=new MEPH.audio.effects.AAFilter(32);b.great()},getOutput:function(){var a=this;return a.outputBuffer||a.output},getStore:function(){var a=this;return a.storeBuffer},enableAAFilter:function(b){var a=this;a.bUseAAFilter=b},isAAFilterEnabled:function(){return this.bUseAAFilter},getAAFilter:function(){var a=this;return a.pAAFilter},setRate:function(b){var a,d=this;d.fRate=b;if(b>1){a=0.5/b}else{a=0.5*b}var c=d.getAAFilter();c.setCutoffFreq(a)},putSamples:function(b,a,c){var d=this;d.processSamples(b,a,c)},upsample:function(h,e,d){var g,a,c;var f=me.storeBuffer;var b=me.outputBuffer;a=Math.floor(e/fRate+16);g=me.transpose(f,h,e,f.ptrEnd(a),d);f.putSamples(g);c=f.numSamples();g=me.pAAFilter.evaluate(b,f,c,me.numChannels,b.ptrEnd(c),f.ptrBegin());b.putSamples(g);f.receiveSamples(g)},downsample:function(a,g,j){var f,d;var h=this,i=h.numChannels,b=h.getOutput(),c=h.tempBuffer,e=h.storeBuffer;e.putSamples(a,g,j);h.assert(c.isEmpty());d=e.numSamples();f=h.pAAFilter.evaluate(c,e,d,i,h.tempBuffer.ptrEnd(d),e.ptrBegin());if(f==0){return}e.receiveSamples(f);d=Math.floor(g/h.fRate+16);f=h.transpose(b,c,f,b.ptrEnd(d),c.ptrBegin());b.putSamples(f)},processSamples:function(f,c,b){var e;var a;var d=this;if(c==0){return}d.assert(d.pAAFilter);if(d.bUseAAFilter==false){a=Math.floor(c/d.fRate+1);e=d.transpose(d.outputBuffer,f,c,d.outputBuffer.ptrEnd(a),b);outputBuffer.putSamples(e);return}if(d.fRate<1){d.upsample(f,c,b)}else{d.downsample(f,c,b)}},transpose:function(c,f,b,e,a){var d=this;if(d.numChannels==2){throw new Error("Does not support stereo")}else{return d.transposeMono(c,f,b,e,a)}},assert:function(a){if(!a){throw new Error("not true")}},setChannels:function(a){var b=this;b.assert(a>0);if(b.numChannels==a){return}b.assert(a==1||a==2);b.numChannels=a;b.storeBuffer.setChannels(numChannels);b.tempBuffer.setChannels(numChannels);b.outputBuffer.setChannels(numChannels);b.resetRegisters()},clear:function(){var a=this;a.outputBuffer.clear();a.storeBuffer.clear()},isEmpty:function(){var a,b=this;return b.storeBuffer.isEmpty()},resetRegisters:function(){var a=this;a.fSlopeCount=0;a.sPrevSampleL=a.sPrevSampleR=0},transposeMono:function(g,a,d,e,c){var b,j;var f=this;j=0;b=0;while(f.fSlopeCount<=1){g.set(e+b,((1-f.fSlopeCount)*f.sPrevSampleL+f.fSlopeCount*a.get(c+0)));b++;f.fSlopeCount+=f.fRate}f.fSlopeCount-=1;var h=false;if(d>1){while(!h){while(f.fSlopeCount>1){f.fSlopeCount-=1;j++;if(j>=d-1){h=true}}if(!h){g.set(e+b,((1-f.fSlopeCount)*a.get(c+j)+f.fSlopeCount*a.get(c+j+1)));b++;f.fSlopeCount+=f.fRate}}}f.sPrevSampleL=a.get(c+d-1);return b}});