MEPH.define("MEPH.audio.processor.FIFOSampleBuffer",{statics:{},extend:"MEPH.audio.processor.FIFOSamplePipe",properties:{sizeInBytes:0,buffer:null,bufferUnaligned:null,samplesInBuffer:0,bufferPos:0},assert:function(a){if(!a){throw new Error("not true")}},initialize:function(a){var b=this;b.assert(a||0>0);b.sizeInBytes=0;b.buffer=null;b.bufferUnaligned=null;b.samplesInBuffer=0;b.bufferPos=0;b.channels=a;b.ensureCapacity(32)},setChannels:function(b){var a;var c=this;c.assert(b>0);a=channels*samplesInBuffer;c.channels=b;c.samplesInBuffer=a/channels},ptrBegin:function(){var a=this;a.assert(a.buffer);return a.bufferPos*a.channels},ptrEnd:function(a){var b=this;b.ensureCapacity(b.samplesInBuffer+a);return b.samplesInBuffer*b.channels},rewind:function(){var b=this;if(b.buffer&&b.bufferPos){var a=new Float32Array(b.buffer.length);var c=b.ptrBegin();[].interpolate(c,c+b.samplesInBuffer*b.channels,function(e,d){a[d]=b.buffer[e]});[].interpolate(0,b.buffer.length,function(d){if(d<=a.length){b.buffer[d]=a[d]}else{b.buffer[d]=0}});b.bufferPos=0}},putSamples:function(b,a,d){d=d||0;var c=this;if(b instanceof MEPH.audio.processor.FIFOSamplePipe){c.memcpy(c.ptrEnd(a),b,a*c.channels,d);c.samplesInBuffer+=a}else{if(b instanceof Float32Array){c.memcpy(c.ptrEnd(a),b,a*c.channels,d);c.samplesInBuffer+=a}else{c.$putSamples(b)}}},$putSamples:function(a){var c;var b=this;c=b.samplesInBuffer+a;b.ensureCapacity(c);b.samplesInBuffer+=a},memcpy:function(a,b,d,e){var c=this;e=e||0;[].interpolate(a,a+d,function(g,f){var h=b instanceof Float32Array?b[f+e]:b.get(f+e);if(c.buffer instanceof Float32Array){c.buffer[g]=h}else{c.buffer.set(g,h)}})},ensureCapacity:function(a){var d,b;var c=this;if(a>c.getCapacity()){var b=new Float32Array(a);if(c.samplesInBuffer){var e=c.ptrBegin();[].interpolate(e,c.samplesInBuffer+e,function(g,f){b[f]=c.buffer[g]})}c.buffer=b;c.bufferPos=0}else{c.rewind()}},getCapacity:function(){var a=this;return !a.buffer?0:(a.buffer.length)/a.channels},numSamples:function(){var a=this;return a.samplesInBuffer},receiveSamples:function(b,a,d){var c;var e=this;if(typeof b==="number"){return e.$receiveSamples(b)}c=(a>e.samplesInBuffer)?e.samplesInBuffer:a;e.copymemout(e.ptrBegin(),b,e.channels*c,d);return e.$receiveSamples(c)},copymemout:function(a,b,d,e){var c=this;e=e||0;[].interpolate(a,a+d,function(g,f){var h=c.buffer instanceof Float32Array?c.buffer[f]:c.buffer.get(f);if(b instanceof Float32Array){b[g+e]=h}else{b.set(g+e,h)}})},$receiveSamples:function(a){var c=this;if(a>=c.samplesInBuffer){var b;b=c.samplesInBuffer;c.samplesInBuffer=0;return b}c.samplesInBuffer-=a;c.bufferPos+=a;return a},isEmpty:function(){var a=this;return(a.samplesInBuffer==0)?1:0},clear:function(){var a=this;a.samplesInBuffer=0;a.bufferPos=0},adjustAmountOfSamples:function(a){if(a<me.samplesInBuffer){me.samplesInBuffer=a}return me.samplesInBuffer}});