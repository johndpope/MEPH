MEPH.define("MEPH.audio.effects.FIRFilter",{requires:[],statics:{},properties:{resultDivFactor:0,resultDivider:0,length:0,lengthDiv8:0,filterCoeffs:null},initialize:function(){},assert:function(a){if(!a){throw new Error("not true")}},getLength:function(){var a=this;return a.length},evaluate:function(b,h,a,c,g,f){var e=this;e.assert(c==1||c==2);var d=e.length;e.assert(e.length>0);e.assert(e.lengthDiv8*8===d);if(a<d){return 0}if(c==2){throw new Error("NOt handling stereo")}else{return e.evaluateFilterMono(b,h,a,g,f)}},evaluateFilterMono:function(n,a,k,o,m){var g,f,e;var h;var l=this;var c=1/l.resultDivider;var b=l.length;var d=l.filterCoeffs;l.assert(b!=0);e=k-b;for(f=0;f<e;f++){h=0;for(g=0;g<b;g+=4){h+=a.get(g+0+m)*d[g+0]+a.get(g+1+m)*d[g+1]+a.get(g+2+m)*d[g+2]+a.get(g+3+m)*d[g+3]}h*=c;n.set(f+o,h);m++}return e},setCoefficients:function(a,e,b){var d=this;d.assert(e>0);if(e%8){throw new Error("FIR filter length not divisible by 8")}d.lengthDiv8=e/8;d.length=d.lengthDiv8*8;d.assert(d.length===e);var c=d.length;d.resultDivFactor=b;d.resultDivider=Math.pow(2,Math.floor(d.resultDivFactor));d.filterCoeffs=null;d.filterCoeffs=new Float32Array(c);a.foreach(function(g,f){d.filterCoeffs[f]=g})}});