MEPH.define("MEPH.audio.music.theory.Notes",{statics:{metricscale:{"1":0,"2":2,"3":4,"4":5,"5":7,"6":9,"7":11},generateSignaturePoints:function(){var a={},g=MEPH.audio.music.theory.Notes,e=g.sharp,f=g.flat;for(var d=0;d<11;d++){var c=g.getKey((g.library.C+d*7)%12,e);if(a[c]==undefined){a[c]={sharps:d}}else{a[c].sharps=d}var b=(g.library.C-d*7)%12;if(b<0){b+=12}c=g.getKey(b,f);if(a[c]==undefined){a[c]={flats:d}}else{a[c].flats=d}}return a},createScaleLib:function(){var b=[];var a="BCDEFGA".split("");for(var c=0;c<10;c++){for(var d=0;d<a.length;d++){b.push(a[d])}}return b},convertToNote:function(c){var b=c%12,d;var e=MEPH.audio.music.theory.Notes;for(var a in e.library){if(e.library[a]===b){d=a;break}}return d+"/"+Math.floor(c/12)},convertToMidi:function(d){var e=MEPH.audio.music.theory.Notes;var c=d.split("").where(function(f){return isNaN(f)}).join("");var b=e.library[(c.split("")[0]+(c.split("")[1]==="b"?e.flat:""))];var a=parseInt(d.split("").where(function(f){return !isNaN(f)}).first());return a*12+b},getKey:function(c,a){var d=MEPH.audio.music.theory.Notes;for(var b in d.library){if(d.library[b]==c){if(b.indexOf(d.flat)==-1&&b.indexOf(d.sharp)==-1){return b}else{if(b.indexOf(d.sharp)!=-1&&a==d.sharp){return b}else{if(b.indexOf(d.flat)!=-1&&a==d.flat){return b}}}}}},getMetric:function(e){var f=MEPH.audio.music.theory.Notes;var b=e.split("");var d=null;var a=0;for(var c=0;c<b.length;c++){if(b[c]=="-"){a--}else{if(b[c]=="+"){a++}else{d=parseInt(f.metricscale[b[c]])}}}if(d==null){throw"key not found"}return d+a},midiNotes:function(b,a){return a.select(function(c){return b+parseInt(c,12)})},getOptions:function(c){var d=MEPH.audio.music.theory.Notes;var b=[];for(var a in d.library){if(d.library[a]==d.library[c]){b.push(a)}}return b},fitNotesTo:function(g,h){var e=[],b=MEPH.audio.music.theory.Notes,d=b.sharp,a=b.flat;for(var f=0;f<g.length;f++){if(g[f].indexOf(d)!=-1||g[f].indexOf(a)!=-1){if(h.indexOf(g[f])==-1){var l=b.getOptions(g[f]);var k=false;for(var c=l.length;c--;){if(h.indexOf(l[c])!=-1){e.push(l[c]);k=true;break}}if(!k){e.push(g[f])}}else{e.push(g[f])}}else{e.push(g[f])}}return e},containsType:function(c,b){for(var a=c.length;a--;){if(b.equals(c[a].voice)){return true}}return false},isAccidentaled:function(e,c){var a=e.split("");var d=0;for(var b=0;b<a.length;b++){if(a[b]===c){d++}}return d},findLetter:function(c,b,g){var h=MEPH.audio.music.theory.Notes;var a=null;for(var d in h.library){if(g!==undefined){var f=h.isAccidentaled(g,"-");if(f){b=h.flat}var e=h.isAccidentaled(g,"+");if(e){b=h.sharp}}if(h.library[d]===c){if(d.indexOf(b)!==-1){a=d}else{if(b===undefined){a=d}}if(d.indexOf(h.sharp)===-1&&d.indexOf(h.flat)===-1){return d}}}return a},convertTo:function(b,c){var a=null;if(c<b){a=(c+12)-b}else{a=(c)-b}return a},convertToMelody:function(b,c){var a=null;if(c<b){a=(c)+b}else{a=(c)+b}return a%12},converttoBase12:function(a){return a.toString(12)}}}).then(function(){var f=MEPH.audio.music.theory.Notes;if(!Array.prototype){Object.defineProperty(Array.prototype,"convertToMetric ",{enumerable:false,writable:true,configurable:true,value:function(){var g=[];for(var h=0;h<this.length;h++){g.push(f.getMetric(this[h]))}return g}})}function a(g){var h=document.createElement("div");h.innerHTML=g;return h.childNodes[0].nodeValue}var e=a("&#x266d;");var d=a("&#x266F;");var c=a("&#x266E;");f.sharp=d;f.flat=e;f.natural=c;var b={};b.C=0;b["B"+d]=12;b["C"+d]=1;b["D"+e]=1;b.D=2;b["D"+d]=3;b["E"+e]=3;b.E=4;b["F"+e]=4;b["E"+d]=5;b.F=5;b["F"+d]=6;b["G"+e]=6;b.G=7;b["G"+d]=8;b["A"+e]=8;b.A=9;b["A"+d]=10;b["B"+e]=10;b.B=11;b["C"+e]=-1;f.library=b;f.signaturePoints=f.generateSignaturePoints();Array.prototype.appendOctave=function(h,g,j){var p=[];var o=f.createScaleLib();var k=1;for(var n=0;n<this.length;n++){var l=g[n].replace(e,"").replace(d,"").replace("#","").toUpperCase();var m=Math.floor(o.indexOf(l,k)/7);if(o.indexOf(l,k)%7==0&&m!=0){m--}k=o.indexOf(l,k);if(j){p[n]=(this[n]+"/"+(h+j[n])).toLowerCase()}else{p[n]=(this[n]+"/"+(h+m)).toLowerCase()}}return p};Array.prototype.makeDrawable=function(h,j,l){var g=[];for(var k=0;k<this.length;k++){g.push(f.findLetter(f.convertToMelody(f.library[h],parseInt(this[k])),j))}return g.appendOctave(l,g)};Array.prototype.toLetterNotes=function(h,j){var g=[];for(var k=0;k<this.length;k++){g.push(f.findLetter(f.convertToMelody(f.library[h],parseInt(this[k])),j))}return g};Array.prototype.removeEmpties=function(){var g=[];for(var h=0;h<this.length;h++){if(this[h]!=null&&this[h]!=""){g.push(this[h])}}return g}});