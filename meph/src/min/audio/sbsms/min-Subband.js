var NDownSample=256,SDownSample=4,subBufSize=512,hSub=NDownSample/(2*SDownSample);MEPH.define("MEPH.audio.sbsms.Subband",{statics:{},properties:{nMarkLatency:0,nAssignLatency:0,nTrial2Latency:0,nAdjust2Latency:0,nTrial1Latency:0,nAdjust1Latency:0,nRenderLatency:0,nWriteSlack:0,nExtractSlack:0,nAnalyzeSlack:0,nMarkSlack:0,nAssignSlack:0,nTrial2Slack:0,nAdjust2Slack:0,nTrial1Slack:0,nAdjust1Slack:0,nRenderSlack:0,renderers:null,stretchRender:null,pitchRender:null,inputFrameSize:0,outputFrameSize:null,totalSizef:null,quality:null,channels:0,N:0,h:0,band:0,nReadFromOutputFrame:0,nToWriteForGrain:0,res:0,resMask:0,nGrainsPerFrame:0,nToDrop0:0,nToDrop1:0,nToDrop2:0,nToPrepad1:0,nToPrepad0:0,bSynthesize:false,nGrainsToAnalyze:null,nGrainsToExtract:null,nGrainsToMark:null,nGrainsToAssign:null,nGrainsToAdvance:null,nGrainsToTrial2:null,nGrainsToAdjust2:null,nGrainsToTrial1:null,nGrainsToAdjust1:null,nGrainsToRender:null,nGrainsWritten:null,nGrainsMarked:null,nGrainsAssigned:null,nGrainsTrialed2:null,nGrainsAdjusted2:null,nGrainsTrialed1:null,nGrainsAdjusted1:null,nGrainsAdvanced:null,nGrainsRendered:null,nGrainsRead:null,nFramesAnalyzed:null,nFramesExtracted:null,nFramesMarked:null,nFramesAssigned:null,nFramesTrialed2:null,nFramesAdjusted2:null,nFramesTrialed1:null,nFramesAdjusted1:null,nFramesRendered:null,nFramesRead:null,parent:null,sub:null,outMixer:null,synthRenderer:null,sms:null,samplesSubIn:null,samplesSubOut:null,grains:null,analyzedGrains:null,grainsIn:null,downSampledGrainAllocator:null},initialize:function(q,t,f,r,d){var m=this;if(t<r.params.bands-1){m.sub=new SubBand(this,t+1,f,r,d)}else{m.sub=null}this.quality=r;this.channels=f;this.parent=q;this.band=t;var j=(1<<t);var p=1<<(r.params.bands-1);this.N=r.params.N[t];var o=r.params.N0[t];var n=r.params.N1[t];var l=r.params.N2[t];this.res=r.params.res[t];this.resMask=this.res-1;this.bSynthesize=d;m.nGrainsPerFrame=this.res;if(m.sub){m.nGrainsPerFrame*=m.sub.nGrainsPerFrame}m.inputFrameSize=p*r.params.H;h=m.inputFrameSize/(j*m.nGrainsPerFrame);m.nToDrop0=(r.getMaxPresamples()/j-o/2);m.nToDrop1=(r.getMaxPresamples()/j-n/2);m.nToDrop2=(r.getMaxPresamples()/j-l/2);m.nToWriteForGrain=(r.getMaxPresamples()/j+l/2);m.nToPrepad1=n/2;m.nToPrepad0=o/2;m.nReadFromOutputFrame=0;m.nFramesAnalyzed=m.nFramesAnalyzed||[];for(var e=0;e<3;e++){m.nFramesAnalyzed.push(0)}for(var k=0;k<m.channels;k++){m.nFramesExtracted=[].interpolate(0,m.channels,function(){return 0});m.nFramesMarked=[].interpolate(0,m.channels,function(){return 0});m.nFramesAssigned=[].interpolate(0,m.channels,function(){return 0});m.nFramesTrialed2=[].interpolate(0,m.channels,function(){return 0});m.nFramesTrialed1=[].interpolate(0,m.channels,function(){return 0});m.nFramesRendered=[].interpolate(0,m.channels,function(){return 0});m.nGrainsMarked=[].interpolate(0,m.channels,function(){return 0});m.nGrainsAssigned=[].interpolate(0,m.channels,function(){return 0});m.nGrainsTrialed2=[].interpolate(0,m.channels,function(){return 0});m.nGrainsTrialed1=[].interpolate(0,m.channels,function(){return 0});m.nGrainsAdvanced=[].interpolate(0,m.channels,function(){return 0})}m.nGrainsWritten=0;m.nFramesAdjusted2=0;m.nGrainsAdjusted2=0;m.nFramesAdjusted1=0;m.nGrainsAdjusted1=0;m.nFramesRead=0;m.totalSizef=0;m.grains=[].interpolate(0,3,function(){return 0});if(m.sub){m.samplesSubIn=new SampleBuf(NDownSample/2);m.grainsIn=new GrainBuf(NDownSample,NDownSample/SDownSample,NDownSample,hann);m.downSampledGrainAllocator=new GrainAllocator(NDownSample/2,NDownSample/2,hann)}if(t>=minTrial1Band){m.grains[0]=new GrainBuf(N,h,o,hannpoisson)}else{m.grains[0]=null}if(t>=minTrial2Band){m.grains[1]=new GrainBuf(N,h,n,hannpoisson)}else{m.grains[1]=null}m.grains[2]=new GrainBuf(N,h,l,hannpoisson);for(var k=0;k<m.channels;k++){if(t>=minTrial1Band){m.analyzedGrains[0][k]=new GrainBuf(N,h,o,hannpoisson)}else{m.analyzedGrains[0][k]=null}if(t>=minTrial2Band){m.analyzedGrains[1][k]=new GrainBuf(N,h,n,hannpoisson)}else{m.analyzedGrains[1][k]=null}m.analyzedGrains[2][k]=new GrainBuf(N,h,l,hannpoisson)}m.sms=new SMS(m.sub?m.sub.sms:null,N,t,r.params.bands-1,h,this.res,o,n,l,f,m.analyzedGrains[2][0].getWindowFFT());var a=m.sms;m.nTrial2Latency=m.sms.getTrial2Latency()/m.nGrainsPerFrame+1;if(a.getTrial2Latency()%m.nGrainsPerFrame){m.nTrial2Latency++}var b=n/(2*h);m.nAdjust2Latency=b/m.nGrainsPerFrame+1;if(b%m.nGrainsPerFrame){m.nAdjust2Latency++}var g=o/(2*h);m.nAdjust1Latency=g/m.nGrainsPerFrame+1;if(g%m.nGrainsPerFrame){m.nAdjust1Latency++}if(m.sub){m.nTrial2Latency=Math.max(m.nTrial2Latency,m.sub.nTrial2Latency)}if(m.sub){m.nAdjust2Latency=Math.max(m.nAdjust2Latency,m.sub.nAdjust2Latency)}if(m.sub){m.nAdjust1Latency=Math.max(m.nAdjust1Latency,m.sub.nAdjust1Latency)}m.nMarkLatency=1;m.nAssignLatency=1;m.nTrial1Latency=1;m.nRenderLatency=1;if(t==0){var u=m.sub;while(u){u.nTrial2Latency=m.nTrial2Latency;u.nAdjust2Latency=m.nAdjust2Latency;u.nAdjust1Latency=m.nAdjust1Latency;u=u.me.sub}}m.nWriteSlack=2;m.nAnalyzeSlack=2;m.nExtractSlack=2;m.nMarkSlack=2;m.nAssignSlack=2;m.nTrial2Slack=2;m.nAdjust2Slack=2;m.nTrial1Slack=2;m.nAdjust1Slack=2;m.nRenderSlack=2;m.synthRenderer=null;m.outMixer=null;m.renderers=[];if(m.bSynthesize){m.synthRenderer=new SynthRenderer(f,j*h);m.renderers.push(m.synthRenderer);if(m.sub){m.samplesSubOut=new SampleBuf(0);m.outMixer=new Mixer(m.synthRenderer,m.samplesSubOut)}else{m.outMixer=m.synthRenderer}}},destroy:function(){var b=this;for(var a=0;a<3;a++){if(b.grains[a]){delete grains[a]}for(var d=0;d<b.channels;d++){if(b.analyzedGrains[a][d]){delete b.analyzedGrains[a][d]}}}delete sms;if(b.sub){delete b.sub;delete b.grainsIn;delete b.samplesSubIn;delete b.downSampledGrainAllocator;if(b.bSynthesize){delete b.samplesSubOut;delete b.outMixer}}if(b.bSynthesize){delete b.synthRenderer}},addRenderer:function(b){var a=this;if(a.sub){a.sub.addRenderer(b)}a.renderers.push(b)},removeRenderer:function(b){var a=this;if(a.sub){a.sub.removeRenderer(b)}a.renderers.removeWhere(function(c){return c===b})},setStretch:function(a){var d=this;if(!d.parent){var c=(a==0?1:a)*inputFrameSize;d.totalSizef+=c;var b=lrintf(d.totalSizef);d.totalSizef-=b;d.outputFrameSize.write(b)}d.stretchRender.write(a);if(d.sub){d.sub.setStretch(a)}},setPitch:function(b){var a=this;if(a.sub){a.sub.setPitch(b)}a.pitchRender.write(b)},stepAnalyzeFrame:function(a){var b=this;if(b.sub){b.sub.stepAnalyzeFrame(a)}b.nFramesAnalyzed[a]++},stepExtractFrame:function(b){var a=this;if(a.sub){a.sub.stepExtractFrame(b)}a.nFramesExtracted[b]++},stepMarkFrame:function(b){var a=this;if(a.sub){a.sub.stepMarkFrame(b)}a.nFramesMarked[b]++},stepAssignFrame:function(b){var a=this;if(a.sub){a.sub.stepAssignFrame(b)}a.nFramesAssigned[b]++},stepTrial2Frame:function(b){var a=this;if(a.sub){a.sub.stepTrial2Frame(b)}a.nFramesTrialed2[b]++},stepAdjust2Frame:function(){var a=this;if(a.sub){a.sub.stepAdjust2Frame()}a.nFramesAdjusted2++},stepTrial1Frame:function(b){var a=this;if(a.sub){a.sub.stepTrial1Frame(b)}a.nFramesTrialed1[b]++},stepAdjust1Frame:function(){var a=this;if(a.sub){a.sub.stepAdjust1Frame()}a.stretchRender.advance(1);a.pitchRender.advance(1);a.nFramesAdjusted1++},stepRenderFrame:function(b){var a=this;if(a.sub){a.sub.stepRenderFrame(b)}a.nFramesRendered[b]++},stepReadFrame:function(){var a=this;if(a.sub){a.sub.stepReadFrame()}a.nFramesRead++},writeInit:function(){var a=this;var b=a.getFramesAtFront(0);b=Math.min(b,a.getFramesAtFront(1));b=Math.min(b,a.getFramesAtFront(2));return(b<=a.nWriteSlack)},readInit:function(){var a=this;var d=a.nFramesRendered[0];for(var b=1;b<a.channels;b++){d=Math.max(0,Math.min(1,Math.min(d,a.nFramesRendered[b]-a.nFramesRead)))}if(a.sub){d=Math.min(d,a.sub.readInit())}return d},analyzeInit:function(a,d,f){var b=this;if(!b.parent){f=b.getFramesAtFront(a);for(var e=0;e<b.channels;e++){f=Math.max(0,Math.min(1,Math.min(f,Math.nAnalyzeSlack-Math.round(b.nFramesAnalyzed[a]-b.nFramesExtracted[e]))))}}if(d){b.nGrainsToAnalyze[a]=f*b.nGrainsPerFrame;if(b.sub){b.sub.analyzeInit(a,d,f)}}return f},extractInit:function(f,d){var b=this;var e;if(b.sub){e=b.res*b.sub.extractInit(f,d)}if(!sub){e=Math.max(0,Math.min(1,b.nExtractSlack+b.nMarkLatency-Math.floor(b.nFramesExtracted[f]-b.nFramesMarked[f])));for(var a=0;a<3;a++){e=Math.max(0,Math.min(1,Math.min(e,Math.floor(b.nFramesAnalyzed[a]-b.nFramesExtracted[f]))))}}if(d){b.nGrainsToExtract[f]=e}return e},markInit:function(e,b){var a=this;var d;if(a.sub){d=a.res*a.sub.markInit(e,b)}if(!sub){d=Math.max(0,Math.min(1,Math.min(Math.floor(a.nFramesExtracted[e]-a.nFramesMarked[e])-a.nMarkLatency,a.nMarkSlack+a.nAssignLatency-Math.floor(a.nFramesMarked[e]-a.nFramesAssigned[e]))))}if(b){a.nGrainsToMark[e]=d}return d},assignInit:function(e,b){var a=this;var d;if(a.sub){d=a.res*a.sub.assignInit(e,b)}else{d=Math.max(0,Math.min(1,Math.min(Math.floor(a.nFramesMarked[e]-a.nFramesAssigned[e])-a.nAssignLatency,a.nAssignSlack+a.nTrial2Latency-Math.floor(a.nFramesAssigned[e]-a.nFramesTrialed2[e]))))}if(b){a.nGrainsToAdvance[e]=d;a.nGrainsToAssign[e]=d;if(d){if(a.nFramesAssigned[e]==0){a.sms.start(0,e)}}}return d},trial2Init:function(e,b){var a=this;var d;if(a.sub){d=a.res*a.sub.trial2Init(e,b)}else{d=Math.max(0,Math.min(1,Math.min(Math.floor(a.nFramesAssigned[e]-a.nFramesTrialed2[e])-a.nTrial2Latency,a.nTrial2Slack+a.nAdjust2Latency-Math.floor(a.nFramesTrialed2[e]-a.nFramesAdjusted2))))}if(b){a.nGrainsToTrial2[e]=d;a.nGrainsTrialed2[e]=0}return d},adjust2Init:function(b){var a=this;var e;if(a.sub){e=a.res*a.sub.adjust2Init(b)}else{e=1;for(var d=0;d<a.channels;d++){e=Math.min(e,Math.floor(a.nFramesTrialed2[d]-a.nFramesAdjusted2-a.nAdjust2Latency));e=Math.min(e,a.nAdjust2Slack+a.nTrial1Latency-Math.floor(a.nFramesAdjusted2-a.nFramesTrialed1[d]))}e=Math.max(0,e)}if(b){a.nGrainsToAdjust2=e;a.nGrainsAdjusted2=0}return e},trial1Init:function(e,b){var a=this;var d;if(a.sub){d=a.res*a.sub.trial1Init(e,b)}else{d=Math.max(0,Math.min(1,Math.min(Math.floor(a.nFramesAdjusted2-a.nFramesTrialed1[e])-a.nTrial1Latency,a.nTrial1Slack+a.nAdjust1Latency-Math.floor(a.nFramesTrialed1[e]-a.nFramesAdjusted1))))}if(b){a.nGrainsToTrial1[e]=d;a.nGrainsTrialed1[e]=0}return d},adjust1Init:function(b){var a=this;var e;if(a.sub){e=a.res*a.sub.adjust1Init(b)}else{e=1;for(var d=0;d<a.channels;d++){e=Math.min(e,Math.floor(a.nFramesTrialed1[d]-a.nFramesAdjusted1-a.nAdjust1Latency));e=Math.min(e,a.nAdjust1Slack+a.nRenderLatency-Math.floor(a.nFramesAdjusted1-a.nFramesRendered[d]))}e=Math.max(0,e)}if(b){a.nGrainsToAdjust1=e;a.nGrainsAdjusted1=0}return e},renderInit:function(e,b){var a=this;var d;if(a.sub){d=a.res*a.sub.renderInit(e,b)}else{d=Math.max(0,Math.min(1,Math.min(Math.floor(a.nFramesAdjusted1-a.nFramesRendered[e])-a.nRenderLatency,a.nRenderSlack-Math.floor(a.nFramesRendered[e]-a.nFramesRead))))}if(b){a.nGrainsRendered[e]=0;a.nGrainsToRender[e]=d}return d},analyze:function(b){var e=this;if(e.sub){e.sub.analyze(b)}if(e.grains[b]){var f=[];for(var a=e.grains[b].readPos;a<e.grains[b].readPos+e.nGrainsToAnalyze[b];a++){var d=e.grains[b].read(a);f.push_back(d)}for(var a=0;a<e.nGrainsToAnalyze[b];a++){f[a].analyze()}for(var a=0;a<e.nGrainsToAnalyze[b];a++){for(var j=0;j<e.channels;j++){e.analyzedGrains[b][j].write(f[a])}}e.grains[b].advance(e.nGrainsToAnalyze[b])}},extract:function(l){var m=this;if(m.sub){m.sub.extract(l)}var e=[].interpolate(0,3,function(){return 0});for(var f=0;f<3;f++){if(m.grains[f]){for(var d=m.analyzedGrains[f][l].readPos;d<m.analyzedGrains[f][l].readPos+m.nGrainsToExtract[l];d++){var j=m.analyzedGrains[f][l].read(d);e[f].push_back(j)}}}for(var d=0;d<m.nGrainsToExtract[l];d++){var b=(m.grains[0]?e[0][d]:null);var a=(m.grains[1]?e[1][d]:null);var n=e[2][d];m.sms.add(b,a,n,l)}for(var f=0;f<3;f++){if(m.grains[f]){m.analyzedGrains[f][l].advance(m.nGrainsToExtract[l])}}},mark:function(e){var d=this;var a=d.parent?1:d.nGrainsToMark[e];var b=0;while(b<a){d.sms.mark(nGrainsMarked[e],e);if(d.nGrainsMarked[e]&d.resMask||d.res===1){if(d.sub){d.sub.mark(e)}}b++;d.nGrainsMarked[e]++}},assign:function(e){var d=this;for(var a=0;a<d.nGrainsToAssign[e];a++){d.assignStart(e);var b=true;while(b){d.assignInit(e);d.assignFind(e);b=d.assignConnect(e)}d.assignStep(e);d.splitMerge(e)}},assignStart:function(b){var a=this;if(a.sub&&!(a.nGrainsAssigned[b]&a.resMask)){a.sub.assignStart(b)}a.sms.assignStart(a.nGrainsAssigned[b],b)},assignInit:function(b){var a=this;if(a.sub){a.sub.assignInit(b)}a.sms.assignInit(a.nGrainsAssigned[b],b)},assignFind:function(b){var a=this;if(a.sub){a.sub.assignFind(b)}a.sms.assignFind(a.nGrainsAssigned[b],b)},assignConnect:function(d){var b=this;var a=false;if(b.sub){if(b.sub.assignConnect(d)){a=true}}if(b.sms.assignConnect(b.nGrainsAssigned[d],d,false)){a=true}return a},assignStep:function(b){var a=this;a.sms.assignConnect(a.nGrainsAssigned[b],b,true);if(a.sub&&!((a.nGrainsAssigned[b]+1)&a.resMask)){a.sub.assignStep(b)}a.sms.start(a.nGrainsAssigned[b]+1,b)},splitMerge:function(b){var a=this;a.nGrainsAssigned[b]++;if(a.sub&&!(a.nGrainsAssigned[b]&a.resMask)){a.sub.splitMerge(b)}a.sms.splitMerge(b)},advance:function(e){var d=this;var a=d.parent?1:d.nGrainsToAdvance[e];var b=0;while(b<a){if(d.sub&&!(d.nGrainsAdvanced[e]&resMask)){d.sub.advance(e)}d.sms.advance(e);d.nGrainsMarked[e]--;d.nGrainsAssigned[e]--;d.nGrainsAdvanced[e]++;b++}},trial2:function(d){var b=this;for(var a=0;a<b.nGrainsToTrial2[d];a++){b.trial2Start(d);b.trial2Trial(d);b.trial2End(d)}},trial2Start:function(b){var a=this;if(!(a.nGrainsTrialed2[b]&a.resMask)){if(a.sub){a.sub.trial2Start(b)}a.sms.trial2Start(b)}},trial2Trial:function(b){var a=this;if(a.sub&&!(a.nGrainsTrialed2[b]&a.resMask)){a.sub.trial2Trial(b)}a.sms.trial2(b)},trial2End:function(b){var a=this;a.nGrainsTrialed2[b]++;if(!(a.nGrainsTrialed2[b]&a.resMask)){if(a.sub){a.sub.trial2End(b)}a.sms.trial2End(b)}},adjust2:function(){var c=this;var a=c.parent?1:c.nGrainsToAdjust2;var b=0;while(b<a){if(!(c.nGrainsAdjusted2&c.resMask)){if(c.sub){c.sub.adjust2()}}c.sms.adjust2();b++;c.nGrainsAdjusted2++}},trial1:function(d){var b=this;for(var a=0;a<b.nGrainsToTrial1[d];a++){b.trial1Start(d);b.trial1Trial(d);b.trial1End(d)}},trial1Start:function(b){var a=this;if(!(a.nGrainsTrialed1[b]&a.resMask)){if(a.sub){a.sub.trial1Start(b)}a.sms.trial1Start(b)}},trial1Trial:function(b){var a=this;if(a.sub&&!(a.nGrainsTrialed1[b]&a.resMask)){a.sub.trial1Trial(b)}a.sms.trial1(b)},trial1End:function(b){var a=this;a.nGrainsTrialed1[b]++;if(!(a.nGrainsTrialed1[b]&a.resMask)){if(a.sub){a.sub.trial1End(b)}a.sms.trial1End(b)}},adjust1:function(){var f=this;var e=f.stretchRender.read();var d=f.pitchRender.read(f.pitchRender.readPos);var b;if(f.pitchRender.nReadable()>=2){b=f.pitchRender.read(f.pitchRender.readPos+1)}else{b=d}var a=f.parent?1:f.nGrainsToAdjust1;var c=0;var g=(b-d)/f.nGrainsToAdjust1;while(c<a){if(!(f.nGrainsAdjusted1&f.resMask)){if(f.sub){f.sub.adjust1()}}f.sms.adjust1(e,d+f.nGrainsAdjusted1*g,d+(f.nGrainsAdjusted1+1)*g);c++;f.nGrainsAdjusted1++}},readSubSamples:function(){var a=this;if(a.sub){a.sub.readSubSamples()}if(a.sub){var c=[].interpolate(0,a.subBufSize,function(){return 0});var b=0;do{b=a.sub.outMixer.read(c,a.subBufSize);a.samplesSubOut.write(c,b)}while(b>0)}},read:function(b,f){var d=this;var c=0;var e=f;d.readSubSamples();while(e&&c<f&&d.outputFrameSize.nReadable()){var a=d.outputFrameSize.read();e=Math.min(f-c,a-d.nReadFromOutputFrame);e=d.outMixer.read(b+c,e);d.nReadFromOutputFrame+=e;c+=e;if(d.nReadFromOutputFrame==a){d.nReadFromOutputFrame=0;d.outputFrameSize.advance(1);d.stepReadFrame()}}return c},renderSynchronous:function(){var b=this;[].interpolate(b.renderers.begin(),b.renderers.end(),function(c){renderers[c].startFrame()});for(var d=0;d<b.channels;d++){b.renderInit(d,true);b.render(d);b.stepRenderFrame(d)}[].interpolate(b.renderers.begin(),b.renderers.end(),function(c){renderers[c].endFrame()});var a=b.outputFrameSize.read();b.outputFrameSize.advance(1);b.stepReadFrame();return a},render:function(f){var d=this;var a=d.parent?1:d.nGrainsToRender[f];var b=0;var e=0;while(b<a){if(d.sub&&!(d.nGrainsRendered[f]&d.resMask)){d.sub.render(f)}d.sms.render(f,d.renderers);d.nGrainsRendered[f]++;b++}},renderComplete:function(a){var b=this;[].interpolate(b.renderers.begin(),renderers.end(),function(c){b.renderers[c].end()})},write:function(i,d,a,c){var o=this;var e=0;while(e<d){var m=Math.min(o.nToWriteForGrain,d-e);if(o.nToDrop2){m=Math.min(o.nToDrop2,m);o.nToDrop2-=m;o.nToDrop1-=m;o.nToDrop0-=m}else{if(o.nToDrop1){m=Math.min(o.nToDrop1,m);o.nToDrop1-=m;o.nToDrop0-=m}else{if(o.nToDrop0){m=Math.min(o.nToDrop0,m)}else{if(o.nToPrepad0){m=Math.min(o.nToPrepad0,m)}}if(o.nToPrepad1){m=Math.min(o.nToPrepad1,m);o.sms.prepad1(i+e,m);o.nToPrepad1-=m}if(o.nToDrop0){o.nToDrop0-=m}else{if(o.nToPrepad0){o.sms.prepad0(i+e,m);o.nToPrepad0-=m}if(o.grains[0]){o.grains[0].write(i+e,m)}}if(o.grains[1]){o.grains[1].write(i+e,m)}}o.grains[2].write(i+e,m)}e+=m;o.nToWriteForGrain-=m;if(o.nToWriteForGrain==0){o.nToWriteForGrain=h;if(!o.parent){if(o.nGrainsWritten==0){o.setStretch(a);o.setPitch(c)}o.nGrainsWritten++;if(o.nGrainsWritten==o.nGrainsPerFrame){o.nGrainsWritten=0}}}}if(o.sub){o.grainsIn.write(i,d);var l=0;for(var f=o.grainsIn.readPos;f<o.grainsIn.writePos;f++){var j=o.grainsIn.read(f);j.analyze();var q=o.downSampledGrainAllocator.create();j.downsample(q);o.samplesSubIn.write(q,hSub);o.downSampledGrainAllocator.forget(q);l++}o.grainsIn.advance(l);var b=o.samplesSubIn.nReadable();var p=o.samplesSubIn.getReadBuf();o.nWriteToSub=o.sub.write(p,o.nWriteToSub,a,c);o.samplesSubIn.advance(b)}return d},process:function(b){var d=this;for(var a=0;a<3;a++){if(d.analyzeInit(a,true)){d.analyze(a);d.stepAnalyzeFrame(a)}}for(var e=0;e<d.channels;e++){if(d.extractInit(e,true)){d.extract(e);d.stepExtractFrame(e)}if(d.markInit(e,true)){d.mark(e);d.stepMarkFrame(e)}if(d.assignInit(e,true)){d.assign(e);d.advance(e);d.stepAssignFrame(e)}if(d.trial2Init(e,true)){d.trial2(e);d.stepTrial2Frame(e)}if(d.adjust2Init(true)){d.adjust2();d.stepAdjust2Frame()}if(d.trial1Init(e,true)){d.trial1(e);d.stepTrial1Frame(e)}if(d.adjust1Init(true)){d.adjust1();d.stepAdjust1Frame()}if(b){if(d.renderInit(e,true)){d.render(e);d.stepRenderFrame(e)}}}},getFramesAtFront:function(a){var b=this;var c=65536;if(b.grains[a]){c=b.grains[a].nReadable()/b.nGrainsPerFrame}if(b.sub){c=Math.min(c,b.sub.getFramesAtFront(a))}return c},getInputFrameSize:function(){var a=this;return a.inputFrameSize}});