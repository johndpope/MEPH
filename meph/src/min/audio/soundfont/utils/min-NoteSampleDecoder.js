MEPH.define("MEPH.audio.soundfont.utils.NoteSampleDecoder",{requires:["MEPH.audio.soundfont.NoteSample","MEPH.audio.soundfont.utils.PCMDecoder","MEPH.audio.soundfont.utils.PCM16BitMono44Khz","MEPH.audio.soundfont.utils.PCM8BitMono44Khz"],extend:"MEPH.audio.soundfont.SFObject",properties:{noteSample:null,_decoder:null,_buffer:null},initialize:function(a){this.noteSample=a},setup:function(b,c){if(this._decoder==null){if(c){var a=new PCM8BitMono44Khz(null,b)}else{var a=new MEPH.audio.soundfont.utils.PCM8BitMono44Khz(null,b)}this._decoder=new MEPH.audio.soundfont.utils.PCMDecoder(this.noteSample.sample.bytes,a)}},extract:function(j,c,f,h,d){if(!this._buffer){this._buffer=new ArrayBuffer(c)}this._buffer.position=0;if(this._decoder==null){if(d){var k=new PCM8BitMono44Khz(null,h)}else{var k=new MEPH.audio.soundfont.utils.PCM8BitMono44Khz(null,h)}this._decoder=new MEPH.audio.soundfont.utils.PCMDecoder(this.noteSample.sample.bytes,k)}var i=this.noteSample.getStart()/2;var n=this.noteSample.getLoopStart()/2;var a=this.noteSample.getLoopEnd()/2;var e=n-i;var m=a-n;var l=0;var g=i+f;var b=0;while(l<c){if(g>=a){g=n+(g-n)%m}b=this._decoder.extract(j,c,g);l+=b;g+=b}return l},stream:function(c,b,a){}});