MEPH.define("MEPH.audio.soundfont.SoundFont",{requires:["MEPH.audio.soundfont.chunks.data.DataChunk","MEPH.audio.soundfont.chunks.data.PresetRecord","MEPH.audio.soundfont.Preset","MEPH.audio.soundfont.NoteSample","MEPH.audio.soundfont.chunks.SoundFontChunk","MEPH.audio.soundfont.chunks.data.InstrumentRecord","MEPH.audio.soundfont.Instrument","MEPH.audio.soundfont.chunks.data.SampleRecord"],extend:"MEPH.audio.soundfont.SFObject",properties:{_instruments:null,_presets:null,_selectedPreset:undefined,_data:undefined},initialize:function(a){this._instruments=[];this._presets=[];this.callParent("SoundFont");this.nonSerializedProperties.push("data");this.setData(a)},getSelectedPreset:function(){return this._selectedPreset},getPresets:function(){return this._presets.slice()},getInstruments:function(){return this._instruments.slice()},getData:function(){return this._data},setData:function(a){this._data=a;this.buildInstruments(this._data.dataChunk);this.buildPresets(this._data.dataChunk)},getNoteSample:function(b,e){var a=this.getPresetZone(b,e);if(a!=null){var d=a.getInstrumentZone(b,e);if(d!=null){var c=this._data.getSampleRecord(d.sampleID);var f=new NoteSample(c,b,e);for(var g in NoteSample.PROPERTY_NAMES){f[g]=d[g];if(a.hasOwnProperty(g)){f[g]+=a[g]}}return f}}return null},getInstrumentZone:function(b,c){var a=this.getPresetZone(b,c);return(a!=null)?a.getInstrumentZone(b,c):null},getPresetZone:function(a,b){return(this.getSelectedPreset()!=null)?this.getSelectedPreset().getPresetZone(a,b):null},selectPreset:function(a){this._selectedPreset=this.getPreset(a)},getPreset:function(b){for(var a=0;a<this._presets.length;a++){var c=this._presets[a];if(c.getPresetID()==b){return c}}return null},getPresetIds:function(){var a=this;return a._presets.select(function(b){return b.getPresetID()})},buildInstruments:function(d){for(var c=0;c<d.getInstrumentRecords().length;c++){var a=d.getInstrumentRecords()[c];var b=new Instrument(a);b.buildZones(d.getSampleRecords());this._instruments.push(b)}},buildPresets:function(c){for(var b=0;b<c.getPresetRecords().length;b++){var a=c.getPresetRecords()[b];var d=new Preset(a);d.buildZones(this.getInstruments());this._presets.push(d)}}});